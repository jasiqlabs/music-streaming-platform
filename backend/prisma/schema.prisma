generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

model users {
  id          Int      @id @default(autoincrement())
  name        String?  @db.VarChar(100)
  email       String   @unique @db.VarChar(100)
  password    String   @db.VarChar(255)
  role        String?  @default("user") @db.VarChar(20)
  status      String   @default("ACTIVE") @db.VarChar(20)
  is_verified Boolean?
  verified    Boolean?

  created_at DateTime  @default(now()) @db.Timestamptz(6)
  updated_at DateTime  @default(now()) @db.Timestamptz(6)
  last_login DateTime? @db.Timestamptz(6)

  profile_image_url        String? @db.Text
  banner_image_url         String? @db.Text
  bio                      String? @db.Text
  phone                    String? @db.VarChar(30)
  genre                    String? @db.VarChar(120)
  social_links             Json?
  revenue_share_percentage Decimal @default(90) @db.Decimal
  admin_remarks            String? @db.Text
  subscription_price       Decimal @default(0) @db.Decimal

  subscription_count Int     @default(0)
  total_listen_time  Int     @default(0)
  audio_quality_pref String  @default("HIGH") @db.VarChar(20)
  notifications_pref Boolean @default(true)

  transactions transactions[]

  artist_stats artist_stats[]
}

model transactions {
  id          Int      @id @default(autoincrement())
  user_id     Int
  date        DateTime @default(now()) @db.Timestamp(6)
  amount      Int
  status      String   @db.VarChar(30)
  artist_name String   @db.VarChar(120)

  user users @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([user_id])
}

model artist_stats {
  artist_id         Int      @id
  total_plays       Int      @default(0)
  total_subscribers Int      @default(0)
  total_earnings    Decimal  @default(0) @db.Decimal
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  updated_at        DateTime @default(now()) @db.Timestamptz(6)

  artist users @relation(fields: [artist_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
}
